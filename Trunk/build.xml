<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build;Deploy;Execute;Tidy" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
		<UsingTask AssemblyFile="CommunityTasks\MSBuild.Community.Tasks.dll" TaskName="MSBuild.Community.Tasks.Zip" />
		<UsingTask AssemblyFile="CommunityTasks\MSBuild.Community.Tasks.dll" TaskName="MSBuild.Community.Tasks.Mail" />
		<UsingTask AssemblyFile="CommunityTasks\MSBuild.Community.Tasks.dll" TaskName="MSBuild.Community.Tasks.Time" />
	<PropertyGroup>
		<OutputFile>HelloMsBuild.exe</OutputFile>
		<OutputDirectory>Output</OutputDirectory>
		<Debug Condition="'$(Delete)'==''">true</Debug>
	</PropertyGroup>
	<ItemGroup>
		<CompileFiles Include="Hello.cs" />
		<DeleteFiles Include="HelloMsBuild.exe;HelloMsBuild.pdb" />
	</ItemGroup>
	<Target Name="Clean">
		<Delete Files="@(DeleteFiles)" />
		<Delete Files="$(OutputDirectory)|**\*" />
		<RemoveDir Directories="$(OutputDirectory)" />
	</Target>
	<Target Name="Build" DependsOnTargets="Clean">
		<Csc Sources="@(CompileFiles)" OutputAssembly="$(OutputFile)" EmitDebugInformation="$(Debug)" />
	</Target>
	<Target Name="Deploy" DependsOnTargets="Clean;Build">
		<MakeDir Directories="$(OutputDirectory)" />
		<Copy SourceFiles="$(OutputFile)" DestinationFolder="$(OutputDirectory)" />
		<Time Format="yyyyMMddHHmmss">
			<Output TaskParameter="FormattedTime" PropertyName="BuildDate" />
		</Time>
		<Zip Files="$(OutputFile)" ZipFileName="HelloMSBuild.$(BuildDate).zip" />
		<Mail SmtpServer = "mail.stockhouse.com"  To="mac.mcdell@stockhouse.com" From="mac.mcdell@stockhouse.com" Subject="Build - MSbuild_$(BuildDate) Succeeded! " 
		body = "Body" /> 
		
	</Target>

	<Target Name="Execute">
<!--		<Message Text="Starting: $(MSBuildProjectDirectory)\$(OutputDirectory)\$(OutputFile) " Importance="low" />
		<Exec  WorkingDirectory="$(OutputDirectory)" Command="$(OutputFile)"></Exec>
	--></Target>
	<Target Name="Tidy">
		<Delete Files="@(DeleteFiles)" />
	</Target>
</Project>
